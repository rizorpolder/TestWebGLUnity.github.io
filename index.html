<!DOCTYPE html>
<html lang="en-us">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
      <title>Lucy’s Ville</title>
      <link rel="shortcut icon" href="TemplateData/favicon.ico">
      <link rel="stylesheet" href="TemplateData/style.css">
      <script src="TemplateData/UnityProgress.js"></script>
      <script src="TemplateData/FullScreen.js"></script>
      <script src="TemplateData/config.js"></script>
      <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
   </head>
   <body>
      <main class="game-wrapper">
         <body>
            <div class="game">
               <div class="webgl-content">
                  <div id="unityContainer">
                     <canvas id="unityContainerCanvas"></canvas>
                  </div>
               </div>
               <script>createProgressBlock()</script>
            </div>
            <script>
				if (document.addEventListener)
				{
					console.log('Фулскрин подписка.');
					document.addEventListener('fullscreenchange', exitHandler, false);
					document.addEventListener('mozfullscreenchange', exitHandler, false);
					document.addEventListener('MSFullscreenChange', exitHandler, false);
					document.addEventListener('webkitfullscreenchange', exitHandler, false);
				}
				
				function exitHandler()
				{
					console.log('Фулскрин выход.');
					if (!document.webkitIsFullScreen && !document.mozFullScreen && !document.msFullscreenElement)
					{
						console.log('Фулскрин выход2.');
						myGameInstance.SendMessage("FullScreenButton", "OnFullScreenDisabled");
					}
				}
			
               if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) 
			   {
               	// Mobile device style: fill the whole browser client area with the game canvas:
               
               	var meta = document.createElement('meta');
               	meta.name = 'viewport';
               	meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
               	document.getElementsByTagName('head')[0].appendChild(meta);
				
				var containerMobile = document.querySelector("#unityContainer");
				var containerCanvasMobile = document.querySelector("#unityContainerCanvas");
               	containerMobile.className = "unity-mobile";
               	containerMobile.style.width = "100%";
               	containerMobile.style.height = "100%";
               	containerCanvasMobile.className = "unity-mobile";
               
               
               } else {			   
               	// Desktop style: Render the game canvas in a window that can be maximized to fullscreen:
               }
				var myGameInstance;
               var currentPurchase;
                let buildScript = document.createElement('script');
                buildScript.src = loaderUrl;
                buildScript.onload = () => {
                    var canvas = document.querySelector("#unityContainerCanvas");
                    createUnityInstance(canvas, config, unityProgress).then(unityInstance=> 
					{
						myGameInstance = unityInstance;
						hideProgressBar(unityInstance);
                        }).catch((message) => {
                          alert(message);
                        });
                    };
					
				vkBridge.send("VKWebAppInit", {});		
				window.bridge = vkBridge;
               
                document.body.append(buildScript);
				
            </script>
		</body>
   </main>
   </body>
</html>
